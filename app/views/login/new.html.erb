<% content_for :title, "Login - Blog Task" %>

<div class="login-container">
  <div class="login-box">
    <h1 class="login-title">Welcome Back</h1>
    <p class="login-subtitle">Sign in to your account</p>

    <% if flash[:alert] %>
      <div class="alert-message error">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <% if flash[:notice] %>
      <div class="alert-message success">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <div id="error-message" class="alert-message error" style="display: none;"></div>
    <div id="success-message" class="alert-message success" style="display: none;"></div>

    <%= form_with url: user_login_path, method: :post, local: false, id: "login-form", class: "login-form" do |form| %>
      <div class="form-group">
        <%= form.label :email, "Email Address", class: "form-label" %>
        <%= form.email_field :email, class: "form-input", placeholder: "Enter your email", required: true, autocomplete: "email" %>
      </div>

      <div class="form-group">
        <%= form.label :password, "Password", class: "form-label" %>
        <%= form.password_field :password, class: "form-input", placeholder: "Enter your password", required: true, autocomplete: "current-password" %>
      </div>

      <div class="form-actions">
        <%= form.submit "Sign In", class: "login-button", id: "login-submit" %>
      </div>
    <% end %>

    <div class="login-footer">
      <p>Don't have an account? <a href="#" class="signup-link">Sign up here</a></p>
    </div>
  </div>
</div>

<style>
  .login-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
  }

  .login-box {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    padding: 40px;
    width: 100%;
    max-width: 400px;
  }

  .login-title {
    font-size: 32px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 8px 0;
    text-align: center;
  }

  .login-subtitle {
    font-size: 16px;
    color: #718096;
    margin: 0 0 32px 0;
    text-align: center;
  }

  .login-form {
    margin-top: 24px;
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 8px;
  }

  .form-input {
    width: 100%;
    padding: 12px 16px;
    font-size: 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    transition: border-color 0.2s, box-shadow 0.2s;
    box-sizing: border-box;
  }

  .form-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .form-input::placeholder {
    color: #a0aec0;
  }

  .form-actions {
    margin-top: 32px;
  }

  .login-button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    color: white;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .login-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }

  .login-button:active {
    transform: translateY(0);
  }

  .login-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .alert-message {
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
    margin-bottom: 24px;
  }

  .alert-message.error {
    background-color: #fed7d7;
    border: 1px solid #fc8181;
    color: #c53030;
  }

  .alert-message.success {
    background-color: #c6f6d5;
    border: 1px solid #68d391;
    color: #22543d;
  }

  .login-footer {
    margin-top: 32px;
    text-align: center;
    font-size: 14px;
    color: #718096;
  }

  .signup-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
  }

  .signup-link:hover {
    text-decoration: underline;
  }

  @media (max-width: 480px) {
    .login-box {
      padding: 32px 24px;
    }

    .login-title {
      font-size: 28px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('login-form');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const submitButton = document.getElementById('login-submit');

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      // Hide previous messages
      errorMessage.style.display = 'none';
      successMessage.style.display = 'none';

      const formData = new FormData(form);
      submitButton.disabled = true;
      submitButton.value = 'Signing in...';

      fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'Accept': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        submitButton.disabled = false;
        submitButton.value = 'Sign In';

        if (data.success) {
          successMessage.textContent = data.message || 'Login successful!';
          successMessage.style.display = 'block';
          // Redirect to blogs page after successful login
          setTimeout(() => {
            window.location.href = '<%= blogs_path %>';
          }, 1000);
        } else {
          errorMessage.textContent = data.error || 'Invalid email or password';
          errorMessage.style.display = 'block';
        }
      })
      .catch(error => {
        submitButton.disabled = false;
        submitButton.value = 'Sign In';
        errorMessage.textContent = 'An error occurred. Please try again.';
        errorMessage.style.display = 'block';
        console.error('Error:', error);
      });
    });
  });
</script>
